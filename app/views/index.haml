%h1 Was zur Hölle ist das hier?

%p
  instABIl ist ein Projekt, das uns den großen Organisationsaufwand für die Abisachen abnehmen soll. Hier können 
  = succeed ',' do
    %a{ :href => '/#users'} Steckbriefe
  %a{ :href => '/courses'} Kursberichte
  und andere Artikel für die Abizeitung online geschrieben werden. Auch werden hier demokratische 
  %a{ :href => '/polls'} Umfragen und Abstimmungen
  stattfinden, deshalb ist die Anmeldung so kompliziert mit dem Schulpasswort (damit jeder nur einmal abstimmen kann).
  %strong
    Die Abimottowahl ist gestartet, klicke auf 
    %a{ :href => '/polls'} Umfragen
    für Details.

%p
  Wenn du oben auf 
  %a{ :href => "/preferences" } "Einstellungen"
  klickst, kannst du deinen Benutzernamen ändern, z.B. ungeliebte Zweitnamen entfernen (das heißt <em>nicht</em> irgendwelche Nicknames eintragen). Bitte trage deine Email-Adresse ein, damit du im Verlauf des Projektes Benachrichtigungen erhältst.

%ul#splash
  %li
    %a{ :href => '/#users'}
      %img{ :src => '/images/icons/id_card.png' }
      %h3 Steckbriefe
  
    %li
      %a{ :href => '/courses'}
        %img{ :src => '/images/icons/page_full.png' }
        %h3 Kursberichte
  
  %li
    %a{ :href => '/polls'}
      %blockquote.speech-bubble
        Abimottowahl!
      %img{ :src => '/images/icons/bars.png' }
      %h3 Umfragen/Abstimmungen


    

%p
  Aus den gesammelten Inhalten wird dann vollautomatisch ein Teil der Abizeitung erzeugt (<del>Herr Krämers</del> <em>jemandes</em> Meinung dazu: "goil!").
  Wenn du irgendwelche Fragen hast, schau doch mal in den Chat. Wenn dir da keiner helfen kann, schreib eine Nachricht in unser 
  %a{ href: "http://piratepad.net/ZTInoZhyvt"} Support-Pad
  (im Zweifelsfall draufklicken).
  %a.download-button{ href: '/current_pdf' } Die aktuelle Version der generierten Abizeitung anschauen

%h2 Chat
%a{ name: 'chat' }
%form{ action: '/messages', method: 'post', id: 'chat_form' }
  %input{ type: 'text', name: 'message[body]', size: 40, maxlength: 90, placeholder: 'Nachricht hier eingeben', id: 'chat_message' }
  %input{ type: 'submit', value: 'Senden' }
%ul#chat
  :javascript
    var pusher = new Pusher('#{Pusher.key}');
    
    function renderMessage(msg) {
      var a = $("<li>")
        .append("<span class=author>"+msg.author+"</span>")
        .append(" <span class=time>("+msg.created_at+")</span>: ")
        .append(" <span class=message>"+msg.body+"</span>")
      $("#chat").prepend(a);
      return a;
    }
  
    var thingChannel = pusher.subscribe('chat');
    thingChannel.bind('message', function(message) {
      var el = renderMessage(message);
      $(el).effect("highlight", {}, 3000);
    });
    
    var latestMessages = JSON.parse('#{Message.newest.reverse.map(&:client_attributes).to_json.gsub("'", "")}')
    
    $('#chat_form').ajaxForm()
    
    $('#chat_form').submit(function() { // immediately clear
      $("#chat_message").val("")
    })
    
    $.each(latestMessages, function() {
      renderMessage(this)
    })

%h2 Alle Benutzer
%a{ name: 'users' }


.global-count
  %span= Person.count
  registrierte Benutzer

.global-count
  %span= Person.where(:page_id.exists => true).count
  angefangene Benutzerseiten

.global-count
  %span= Course.all.select{|c|c.page.present?}.count
  angefangene Kursberichte bei
  = Course.count
  Kursen

.global-count
  %span= Poll.count
  Umfragen und Abstimmungen

%p.small Es werden hier nur Leute angezeigt, die sich schon mal hier angemeldet haben! Das sind also nicht alle Schüler aus der Stufe.

%ul
  - Person.order_by(:uid).each do |person|
    %li
      %a{ :href => "/people/#{person.uid}" }= person.name
      - if person.page.present?
        %span== (#{person.page.author.name} schreibt die Seite)