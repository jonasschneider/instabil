%h1 Was zur Hölle ist das hier?
%p Eine Seite für die Planung unserer Abisachen, insbesondere der Abizeitung.

%ul#splash
  %li
    %a{ :href => '/#newusers'}
      %img{ :src => '/images/icons/id_card.png' }
      %h3 Steckbriefe
  
  /
    %li.disabled
      %a{ :href => '/'}
        %img{ :src => '/images/icons/page_full_greyscale.png' }
        %h3 Kursberichte (bald)
  
  %li
    %a{ :href => '/polls'}
      %img{ :src => '/images/icons/bars.png' }
      %h3 Umfragen/Abstimmungen

%h2 Chat
%a{ name: 'chat' }
%form{ action: '/messages', method: 'post', id: 'chat_form' }
  %input{ type: 'text', name: 'message[body]', size: 40, placeholder: 'Nachricht hier eingeben', id: 'chat_message' }
  %input{ type: 'submit', value: 'Senden' }
%ul#chat
  :javascript
    var pusher = new Pusher('#{Pusher.key}');
    
    function renderMessage(msg) {
      var a = $("<li>")
        .append("<span class=author>"+msg.author+"</span>")
        .append(" <span class=time>("+msg.created_at+")</span>: ")
        .append(" <span class=message>"+msg.body+"</span>")
      $("#chat").prepend(a);
      return a;
    }
  
    var thingChannel = pusher.subscribe('chat');
    thingChannel.bind('message', function(message) {
      var el = renderMessage(message);
      $(el).effect("highlight", {}, 3000);
    });
    
    var latestMessages = JSON.parse('#{Message.newest.reverse.map(&:client_attributes).to_json.gsub("'", "")}')
    
    $('#chat_form').ajaxForm()
    
    $('#chat_form').submit(function() { // immediately clear
      $("#chat_message").val("")
    })
    
    $.each(latestMessages, function() {
      renderMessage(this)
    })

%h2 Neue Benutzer
%a{ name: 'newusers' }
%p Klicken auf den Namen führt zur Benutzerseite des jeweiligen Menschen.
%ul
  - Person.all.each do |person|
    %li
      %a{ :href => "/people/#{person.uid}" }= person.name